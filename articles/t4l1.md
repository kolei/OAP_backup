# Тема 4. Процедуры и функции. Работа с файлами (Лекция 1)
До этого мы изучали императивный (структурный) тип программирования. Хотя это наиболее естественный тип работы для компьютера, но с точки зрения разработки программ людьми он не годится для разработки сколько нибудь сложных проектов, человек просто не в состоянии запомнить весь этот код.

Для упрощения работы стали выделять обособленные или повторяющиеся части программы в отдельные подпрограммы.

<a name="subroutine"></a>

**Подпрограмма** - это отдельная функционально независимая часть программы. Любая подпрограмма обладает той же структурой, которой обладает и вся программа.

Подпрограммы решают три важные задачи:
* избавляют от необходимости многократно повторять в тексте программы аналогичные фрагменты;
* улучшают структуру программы, облегчая ее понимание;
* повышают устойчивость к ошибкам программирования и непредвидимым последствиям при модификациях программы.

Очень важно понимать, что в подпрограммы выделяется любой законченный фрагмент программы. В качестве ориентиров просмотрите следующие рекомендации:
* Когда Вы несколько раз перепишите в программе одни и те же последовательности команд, необходимость введения подпрограммы приобретает характер острой внутренней потребности.
* Иногда слишком много мелочей закрывают главное. Полезно убрать в подпрограмму подробности, заслоняющие смысл основной программы.
* Полезно разбить длинную программу на составные части - просто как книгу разбивают на главы. При этом основная программа становится похожей на оглавление.

Бывают сложные частные алгоритмы. Полезно отладить их отдельно в небольших тестирующих программах. Включение программ с отлаженными алгоритмами в основную программу будет легким, если они оформлены как подпрограммы.

Все, что Вы сделали хорошо в одной программе, Вам захочется перенести в новые. Для повторного использования таких частей лучше сразу выделять в программе полезные алгоритмы в отдельные подпрограммы.

Подпрограммы могут быть *встроенными*, т.е. определенными системой, и *собственными*, т.е. определенными программистом.

Встроенная подпрограмма (процедура или функция) - подпрограмма, включенная в ядро языка программирования, доступ к которой обеспечивается средствами языка программирования.

Из набора процедур и функций по обработке одного типа информации составляются модули. Доступ к процедурам и функциям модуля осуществляется при подключении этого модуля (import array).

В ядре и стандартных модулях содержится большое количество стандартных подпрограмм, но невозможно создать модуля, который бы содержал все нужные программисту подпрограммы. Поэтому большую роль в создании программ играют собственные подпрограммы, которые создает программист для решения конкретной задачи.

Подпрограммы группируются в отдельных файлах - модулях. Для того чтобы основная программа могла использовать модуль, он должен быть подключен к основной программе.

Структура текста подпрограммы соответствует структуре текста основной программы.

Вызов подпрограммы происходит при каждом употреблении ее имени в основной (или вызывающей) программе. При вызове подпрограммы выполнение основной программы приостанавливается, и управление передается в подпрограмму, где выполняются команды, заданные в ней. Подпрограмма завершается, если выполнены все ее процедуры или по специальной команде выхода из подпрограммы return. По окончании работы подпрограммы управление возвращается основной программе, иначе говоря, к первой команде, следующей за обращением к этой подпрограмме.

<a name="область_видимости"></a>

## Область видимости
При разбиении программы на подпрограммы возникает вопрос с областью видимости переменных объявленных в основном модуле, в подпрограммах и модулях.

Область видимости указывает интерпретатору, когда наименование (или переменная) видимо. Другими словами, область видимости определяет, когда и где вы можете использовать свои переменные, функции, и т.д. Если вы попытаетесь использовать что-либо, что не является в вашей области видимости, вы получите ошибку NameError.

Python содержит три разных типа области видимости:
* Глобальная область видимости
* Локальная область видимости
* Нелокальная область видимости (была добавлена в Python 3)

### Глобальная область видимости
Глобальный контекст подразумевает, что переменная является глобальной, она определена вне любой из функций и доступна любой функции в программе. 

Например:
```python
name = "Tom"
 
def say_hi():
    print("Hello", name)
 
def say_bye():
    print("Good bye", name)
 
say_hi()  # Hello Tom
say_bye() # Good bye Tom
```

Здесь переменная *name* является глобальной и имеет глобальную область видимости. И обе определенные здесь функции могут свободно ее использовать.

### Локальная область видимости
В отличие от глобальных переменных локальная переменная определяется внутри функции и доступна только из этой функции, то есть имеет локальную область видимости:
```python
def say_hi():
    name = "Sam"
    surname = "Johnson"
    print("Hello", name, surname)
 
 
def say_bye():
    name = "Tom"
    print("Good bye", name)
 
say_hi()  # Hello Sam Johnson
say_bye() # Good bye Tom
```

В данном случае в каждой из двух функций определяется локальная переменная name. И хотя эти переменные называются одинаково, но тем не менее это две разных переменных, каждая из которых доступна только в рамках своей функции. Также в функции say_hi определена переменная surname, которая также является локальной, поэтому в функции say_bye мы ее использовать не сможем.

Есть еще один вариант определения переменной, когда локальная переменная скрывают глобальную с тем же именем:
```python
name = "Tom"
  
def say_hi():
    print("Hello", name)

def say_bye():
    name = "Bob"
    print("Good bye", name)
 
say_hi()  # Hello Tom
say_bye() # Good bye Bob
```

Здесь определена глобальная переменная *name*. Однако в функции say_bye определена локальная переменная с тем же именем *name*. И если функция say_hi использует глобальную переменную, то функция say_bye использует локальную переменную, которая скрывает глобальную.

Если же мы хотим изменить в локальной функции глобальную переменную, а не определить локальную, то необходимо использовать ключевое слово global:
```python
def say_bye():
    global name
    name = "Bob"
    print("Good bye", name)
```

В Python, как и во многих других языках программирования, не рекомендуется использовать глобальные переменные. Единственной допустимой практикой является определение небольшого числа глобальных констант, которые не изменяются в процессе работы программы.

```python
PI = 3.14
 
# вычисление площади круга
def get_circle_square(radius):
    print("Площадь круга с радиусом", radius, "равна", PI * radius * radius)
 
get_circle_square(50)
```

В данном случае число 3.14 представлено константой PI. Понятно, что это значение в принципе не изменится, поэтому его можно вынести из функций и определить в виде константы. Как правило, имя константы определяется заглавными буквами.

### Нелокальная область видимости
Оператор **nonlocal** заставляет перечисленные идентификаторы ссылаться на ранее связанные переменные в ближайшей охватывающей области. Например:
```python
def foo():
    x = 10
    def bar():
        nonlocal x
        print(x)
        x += 1
    bar()
    print(x)
foo()
>10
>11
```

### Неочевидные моменты видимости переменных
Рассмотрим пример:
```python
x = 10
def foo():
    print(x)
    x += 1
```

Питон при попытке выполнить функцию **foo** выдаст ошибку. Это происходит потому, что локальная переменная х перекрывает глобальную, но на момент выполнения команды print она еще не определена. Для исправления такой ситуации нужно добавить команду global х или nonlocal х перед функцией print.

### Как организовать совместный доступ к глобальным переменным для нескольких модулей?
Канонический способ организовать подобный доступ - это создать отдельный модуль (часто называемый config или cfg). Просто добавьте import config в каждый модуль приложения. При этом модуль становится доступен через глобальное имя. Поскольку существует только один экземпляр модуля, любые изменения, произведённые в модуле отражаются везде. Например:

``config.py ``
```python 
x = 0
```

``mod.py``
```python
import config
config.x = 1
```

``main.py``
```python

import config
import mod
print(config.x)
```

<a name="function"></a>

## Функции в Python



[Понятие подпрограммы](#subroutine)
[Область видимости](#область_видимости)
[Функции в Python](#function)

Процедуры и функции, их сущность, назначение и различие. 
Организация процедур, стандартные процедуры. Процедуры, определенные пользователем: синтаксис, передача аргументов. Возврат результата.
